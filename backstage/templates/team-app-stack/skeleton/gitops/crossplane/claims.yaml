# Crossplane Claims for Team: ${{ values.teamName }}
# Environment: ${{ values.environment }}
# Generated by Backstage team-app-stack template

---
# Resource Group (always created)
apiVersion: azure.upbound.io/v1beta1
kind: ResourceGroup
metadata:
  name: ${{ values.resourceGroupName }}
  namespace: ${{ values.namespace }}
  annotations:
    link.argocd.argoproj.io/external-link: https://portal.azure.com/#@/resource/subscriptions/f989de0f-8697-4a05-8c34-b82c941767c0/resourceGroups/${{ values.resourceGroupName }}
  labels:
    app.kubernetes.io/managed-by: crossplane
    app.kubernetes.io/part-of: team-${{ values.teamName }}
    armportal.chrishouse.io/team: ${{ values.teamName }}
    armportal.chrishouse.io/environment: ${{ values.environment }}
    armportal.chrishouse.io/created-by: backstage
spec:
  forProvider:
    location: ${{ values.location }}
  providerConfigRef:
    name: default
{%- if values.includeStorage %}

---
# Storage Account
apiVersion: storage.azure.upbound.io/v1beta1
kind: Account
metadata:
  name: ${{ values.storageAccountName }}
  namespace: ${{ values.namespace }}
  annotations:
    link.argocd.argoproj.io/external-link: https://portal.azure.com/#@/resource/subscriptions/f989de0f-8697-4a05-8c34-b82c941767c0/resourceGroups/${{ values.resourceGroupName }}/providers/Microsoft.Storage/storageAccounts/${{ values.storageAccountName }}
    crossplane.io/external-name: ${{ values.storageAccountName }}
  labels:
    app.kubernetes.io/managed-by: crossplane
    app.kubernetes.io/part-of: team-${{ values.teamName }}
    armportal.chrishouse.io/team: ${{ values.teamName }}
    armportal.chrishouse.io/environment: ${{ values.environment }}
    armportal.chrishouse.io/created-by: backstage
spec:
  forProvider:
    resourceGroupNameRef:
      name: ${{ values.resourceGroupName }}
    location: ${{ values.location }}
    accountTier: Standard
    accountReplicationType: LRS
    accountKind: StorageV2
    minTlsVersion: TLS1_2
    tags:
      team: ${{ values.teamName }}
      environment: ${{ values.environment }}
      managed-by: crossplane
  providerConfigRef:
    name: default
  writeConnectionSecretToRef:
    name: ${{ values.storageAccountName }}-conn
    namespace: ${{ values.namespace }}
{%- endif %}
{%- if values.includeKeyVault %}

---
# Key Vault
apiVersion: keyvault.azure.upbound.io/v1beta1
kind: Vault
metadata:
  name: ${{ values.keyVaultName }}
  namespace: ${{ values.namespace }}
  annotations:
    link.argocd.argoproj.io/external-link: https://portal.azure.com/#@/resource/subscriptions/f989de0f-8697-4a05-8c34-b82c941767c0/resourceGroups/${{ values.resourceGroupName }}/providers/Microsoft.KeyVault/vaults/${{ values.keyVaultName }}
    crossplane.io/external-name: ${{ values.keyVaultName }}
  labels:
    app.kubernetes.io/managed-by: crossplane
    app.kubernetes.io/part-of: team-${{ values.teamName }}
    armportal.chrishouse.io/team: ${{ values.teamName }}
    armportal.chrishouse.io/environment: ${{ values.environment }}
    armportal.chrishouse.io/created-by: backstage
spec:
  forProvider:
    resourceGroupNameRef:
      name: ${{ values.resourceGroupName }}
    location: ${{ values.location }}
    tenantId: "354b7ce2-bca3-4af5-b19a-e05a09b68a7b"
    skuName: standard
    softDeleteRetentionDays: 7
    purgeProtectionEnabled: false
    enabledForDeployment: true
    enabledForDiskEncryption: false
    enabledForTemplateDeployment: true
    tags:
      team: ${{ values.teamName }}
      environment: ${{ values.environment }}
      managed-by: crossplane
  providerConfigRef:
    name: default
{%- endif %}
{%- if values.includeAppConfig %}

---
# App Configuration
apiVersion: appconfiguration.azure.upbound.io/v1beta1
kind: Configuration
metadata:
  name: ${{ values.appConfigName }}
  namespace: ${{ values.namespace }}
  annotations:
    link.argocd.argoproj.io/external-link: https://portal.azure.com/#@/resource/subscriptions/f989de0f-8697-4a05-8c34-b82c941767c0/resourceGroups/${{ values.resourceGroupName }}/providers/Microsoft.AppConfiguration/configurationStores/${{ values.appConfigName }}
    crossplane.io/external-name: ${{ values.appConfigName }}
  labels:
    app.kubernetes.io/managed-by: crossplane
    app.kubernetes.io/part-of: team-${{ values.teamName }}
    armportal.chrishouse.io/team: ${{ values.teamName }}
    armportal.chrishouse.io/environment: ${{ values.environment }}
    armportal.chrishouse.io/created-by: backstage
spec:
  forProvider:
    resourceGroupNameRef:
      name: ${{ values.resourceGroupName }}
    location: ${{ values.location }}
    sku: standard
    tags:
      team: ${{ values.teamName }}
      environment: ${{ values.environment }}
      managed-by: crossplane
  providerConfigRef:
    name: default
{%- endif %}
