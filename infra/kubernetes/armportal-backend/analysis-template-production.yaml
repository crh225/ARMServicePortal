# AnalysisTemplate for post-promotion monitoring
# Monitors production environment after promotion and triggers rollback if issues detected
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: production-health-monitor
  namespace: armportal-backend
spec:
  metrics:
  # Production health endpoint check - must return "ok"
  - name: production-health
    interval: 30s
    count: 10
    successCondition: result == "ok"
    failureLimit: 3
    provider:
      web:
        url: https://portal-api.chrishouse.io/api/health
        timeoutSeconds: 10
        jsonPath: "{$.status}"
        headers:
          - key: Content-Type
            value: application/json
