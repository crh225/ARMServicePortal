# Azure Key Vault SecretProviderClass for Backstage secrets
# Uses CSI Secret Store Driver to mount secrets from Azure Key Vault
---
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-backstage-secrets
  namespace: backstage
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "false"
    clientID: "4db95085-ec10-421b-8b04-8052ad391fcf"
    keyvaultName: "akvnotintf1"
    tenantId: "354b7ce2-bca3-4af5-b19a-e05a09b68a7b"
    objects: |
      array:
        - |
          objectName: backstage-backend-secret
          objectType: secret
        - |
          objectName: backstage-github-token
          objectType: secret
        - |
          objectName: backstage-arm-portal-api-key
          objectType: secret
        - |
          objectName: backstage-postgres-password
          objectType: secret
        - |
          objectName: ARGOCD-AUTH-TOKEN
          objectType: secret
        - |
          objectName: K8S-MGMT-SERVICE-ACCOUNT-TOKEN
          objectType: secret
        - |
          objectName: K8S-APP-SERVICE-ACCOUNT-TOKEN
          objectType: secret
        - |
          objectName: PORT-BACKSTAGE-TOKEN
          objectType: secret
        - |
          objectName: PORT-CLIENT-ID
          objectType: secret
        - |
          objectName: PORT-CLIENT-SECRET
          objectType: secret
        - |
          objectName: ARGOCD-GITHUB-PAT
          objectType: secret
        # Auth0 authentication secrets
        - |
          objectName: AUTH-AUTH0-DOMAIN
          objectType: secret
        - |
          objectName: AUTH-AUTH0-CLIENT-ID
          objectType: secret
        - |
          objectName: AUTH-AUTH0-CLIENT-SECRET
          objectType: secret
        - |
          objectName: AUTH-SESSION-SECRET
          objectType: secret
  secretObjects:
    - secretName: backstage-secrets
      type: Opaque
      data:
        - objectName: backstage-backend-secret
          key: BACKEND_SECRET
        - objectName: backstage-github-token
          key: GITHUB_TOKEN
        - objectName: backstage-arm-portal-api-key
          key: ARM_PORTAL_API_KEY
        - objectName: backstage-postgres-password
          key: POSTGRES_PASSWORD
        - objectName: ARGOCD-AUTH-TOKEN
          key: ARGOCD_AUTH_TOKEN
        - objectName: K8S-MGMT-SERVICE-ACCOUNT-TOKEN
          key: K8S_MGMT_SERVICE_ACCOUNT_TOKEN
        - objectName: K8S-APP-SERVICE-ACCOUNT-TOKEN
          key: K8S_APP_SERVICE_ACCOUNT_TOKEN
        - objectName: PORT-BACKSTAGE-TOKEN
          key: PORT_BACKSTAGE_TOKEN
        - objectName: PORT-CLIENT-ID
          key: PORT_CLIENT_ID
        - objectName: PORT-CLIENT-SECRET
          key: PORT_CLIENT_SECRET
        - objectName: ARGOCD-GITHUB-PAT
          key: ARGOCD_GITHUB_PAT
        # Auth0 authentication secrets
        - objectName: AUTH-AUTH0-DOMAIN
          key: AUTH_AUTH0_DOMAIN
        - objectName: AUTH-AUTH0-CLIENT-ID
          key: AUTH_AUTH0_CLIENT_ID
        - objectName: AUTH-AUTH0-CLIENT-SECRET
          key: AUTH_AUTH0_CLIENT_SECRET
        - objectName: AUTH-SESSION-SECRET
          key: AUTH_SESSION_SECRET
