# AnalysisTemplate for pre-promotion health checks
# Tests the preview environment before allowing promotion to production
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: preview-health-check
  namespace: armportal-backend
spec:
  metrics:
  # Health endpoint check - must return "ok"
  - name: preview-health
    interval: 5s
    count: 3
    successCondition: result == "ok"
    failureLimit: 1
    provider:
      web:
        url: https://portal-api-preview.chrishouse.io/api/health
        timeoutSeconds: 5
        jsonPath: "{$.status}"
        headers:
          - key: Content-Type
            value: application/json
