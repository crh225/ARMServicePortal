# SecretProviderClass for Azure Key Vault integration
# Secrets are synced from Azure Key Vault to Kubernetes secrets
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: portal-api-secrets
  namespace: portal-api
  labels:
    app.kubernetes.io/name: portal-api
    app.kubernetes.io/component: backend
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "false"
    clientID: "4db95085-ec10-421b-8b04-8052ad391fcf"  # portal-api workload identity
    keyvaultName: "akvnotintf1"
    tenantId: "354b7ce2-bca3-4af5-b19a-e05a09b68a7b"
    objects: |
      array:
        - objectName: GH-APP-PRIVATE-KEY-BASE64
          objectType: secret
        - objectName: GH-OAUTH-CLIENT-SECRET
          objectType: secret
        - objectName: GITHUB-WEBHOOK-SECRET
          objectType: secret
        - objectName: ELASTICSEARCH-API-KEY
          objectType: secret
  secretObjects:
    - secretName: backend-secrets
      type: Opaque
      data:
        - objectName: GH-APP-PRIVATE-KEY-BASE64
          key: GH_APP_PRIVATE_KEY_BASE64
        - objectName: GH-OAUTH-CLIENT-SECRET
          key: GH_OAUTH_CLIENT_SECRET
        - objectName: GITHUB-WEBHOOK-SECRET
          key: GITHUB_WEBHOOK_SECRET
        - objectName: ELASTICSEARCH-API-KEY
          key: ELASTICSEARCH_API_KEY
