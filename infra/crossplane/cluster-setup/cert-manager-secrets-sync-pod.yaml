# Helper pod to sync secrets from Azure Key Vault to cert-manager namespace
# This pod mounts the CSI volume which triggers secret creation
---
apiVersion: v1
kind: Pod
metadata:
  name: cert-manager-secrets-sync
  namespace: cert-manager
  labels:
    app: secrets-sync
spec:
  containers:
  - name: secrets-sync
    image: mcr.microsoft.com/aks/fundamental/base-ubuntu:v0.0.11
    command: ["/bin/sh"]
    args: ["-c", "while true; do sleep 3600; done"]
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "128Mi"
        cpu: "100m"
    volumeMounts:
    - name: secrets-store
      mountPath: "/mnt/secrets-store"
      readOnly: true
  volumes:
  - name: secrets-store
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "cert-manager-secrets"
